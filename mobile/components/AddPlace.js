'use strict';

var React = require('react-native');
var ViewCreatedTour = require('./ViewCreatedTour');
var utils = require('../lib/utility');
var t = require('tcomb-form-native');
var Form = t.form.Form;
var styles = require('../lib/stylesheet');

var {
  Component,
  StyleSheet,
  Text,
  TextInput,
  TouchableHighlight,
  View,
} = React;

// Place defines domain model for form.
var Place = t.struct({
  Place: t.String,
  Address: t.String,
  Description: t.String,
  // placeOrder: t.Number
});

var options = {
  auto: 'placeholders',
};

class AddPlace extends Component {
  
  /**
   * Creates an instance of AddPlace.
   */
  constructor(props) {
    super(props);
    this.state = {
      tourId: this.props.tourId
    };
  }

  /**
   * Gets place details using tcomb-form-native getValue method and posts it in the database.
   */
  onPressSave () {
    /**
     * getValue() gets the values of the form.
     */
    var tourId = this.state.tourId;
    var newPlace = this.refs.form.getValue();
    console.log('getvalue addplace.....', newPlace);
    var reqBody = {
      Place: newPlace.Place,
      Address: newPlace.Address,
      Description: newPlace.Description,
      // placeOrder: newPlace.placeOrder,
      tourId: tourId
    };

    utils.makeRequest('addPlace', reqBody)
      .then(response => {
        console.log('response body in Add Place: ', response);
        utils.navigateTo.call(this, "View Tour", ViewCreatedTour, {tourId});
      });
  }

  /**
   * renders a form generated by tcomb-form-native based on the domain model 'Place'.
   */
  render () {
    return (
      <View style={ styles.container }>
      {/* display */}
      <View>
        <Form
          ref="form"
          type={ Place }
          options={ options }/>
      </View>

      <View style={ styles.photoContainer }>
      <Text style={ styles.text }>Add a Photo</Text> 
      </View>
      <View style={ styles.photoContainer }>
        <View>
          <Text style={ styles.text }>Add Audio</Text>
        </View>
      </View>

      <TouchableHighlight style={ styles.button } onPress={ this.onPressSave.bind(this) } underlayColor='#99d9f4'>
        <Text style={ styles.buttonText }>Add Place</Text>
      </TouchableHighlight>
    </View>
    );
  }
}

var styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#727272',
    justifyContent: 'center',
    padding: 20,
  },
  title: {
    fontSize: 30,
    alignSelf: 'center',
    marginBottom: 30
  },
  photoContainer: {
    justifyContent: 'center',
    padding: 20,
  },
  buttonText: {
    color: '#FFF',
    fontFamily: 'Raleway',
    fontSize: 20,
    fontWeight: 'bold'
  },
  text: {
    color: '#00BCD4',
    fontFamily: 'Raleway',
    fontSize: 20,
    fontWeight: 'bold',
    justifyContent: 'center'
  },
  button: {
    backgroundColor: '#FFC107',
    padding: 16,
    alignItems: 'center',
    marginTop: 25,
    marginBottom: 35,
    borderRadius: 10,
    borderWidth: 2,
    borderColor: '#FFC107',
    justifyContent: 'center',
    alignSelf: 'stretch',
  },
});

module.exports = AddPlace;
